{% extends "base.html" %}

{% block title %}SorularÄ±m - ReviseMe{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Motive MesajÄ± Kutusu -->
    <div id="motivationBox" class="alert alert-info d-flex align-items-center justify-content-between" style="font-size:1.1em; box-shadow:0 2px 8px #b3d8ff55;">
        <span id="motivationText"><i class="fas fa-bolt text-primary me-2"></i> {{ motivation_message }}</span>
        <button type="button" class="btn-close" aria-label="Kapat" onclick="document.getElementById('motivationBox').style.display='none';"></button>
    </div>

    <!-- Sekmeli MenÃ¼ -->
    <div class="mb-3">
        <div class="btn-group w-100" role="group">
            <a href="{{ url_for('questions') }}" class="btn btn-primary{% if request.endpoint == 'questions' %} active{% endif %}">SorularÄ±m</a>
            <a href="{{ url_for('favorites') }}" class="btn btn-warning">â˜… Favorilerim</a>
            <a href="{{ url_for('today_questions') }}" class="btn btn-secondary">BugÃ¼nÃ¼n SorularÄ±</a>
            <a href="{{ url_for('past_questions') }}" class="btn btn-dark">GeÃ§miÅŸ Sorular</a>
        </div>
    </div>

    <!-- Ãœstte Yeni Soru Ekle Butonu -->
    <div class="d-flex justify-content-end mb-3">
        <a href="{{ url_for('add_question') }}" class="btn btn-success">
            <i class="fas fa-plus"></i> Yeni Soru Ekle
        </a>
    </div>

    <!-- Kategori KartlarÄ± -->
    <div class="row">
        {% set icons = {
            'Matematik': 'ğŸ“',
            'TÃ¼rk Dili ve EdebiyatÄ±': 'ğŸ“–',
            'Felsefe': 'ğŸ§ ',
            'Din': 'ğŸ•Œ',
            'CoÄŸrafya': 'ğŸŒ',
            'Fizik': 'âš›ï¸',
            'Kimya': 'ğŸ§ª',
            'Biyoloji': 'ğŸ§¬',
            'Tarih': 'ğŸº',
            'YabancÄ± Dil': 'ğŸŒ'
        } %}
        {% for cat in categories %}
        {% if cat.Name != 'Ä°ngilizce' %}
        <div class="col-12 col-md-6 col-lg-4 mb-4">
            <div class="card h-100 category-card text-center" style="cursor:pointer;" onclick="window.location.href='{{ url_for('category_questions', category_id=cat.CategoryId) }}'">
                <div class="card-body d-flex flex-column justify-content-center align-items-center" style="min-height:120px;">
                    <div style="font-size:2.5rem;">{{ icons.get(cat.Name, 'ğŸ“š') }}</div>
                    <div class="mt-2 fw-bold" style="font-size:1.2em;">{{ cat.Name }}</div>
                    <div class="mt-2 text-muted" style="font-size:1em;">
                        {{ questions|selectattr('CategoryId', 'equalto', cat.CategoryId)|list|length }} soru
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentQuestionId = null;

function showReminderModal(questionId) {
    currentQuestionId = questionId;
    const modal = new bootstrap.Modal(document.getElementById('reminderModal'));
    modal.show();
}

function saveReminder() {
    if (!currentQuestionId) return;
    
    const frequency = document.getElementById('frequency').value;
    const time = document.getElementById('time').value;
    
    fetch(`/set_reminder/${currentQuestionId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        body: JSON.stringify({
            frequency: frequency,
            time: time
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('HatÄ±rlatÄ±cÄ± baÅŸarÄ±yla ayarlandÄ±!');
            bootstrap.Modal.getInstance(document.getElementById('reminderModal')).hide();
        } else {
            alert('HatÄ±rlatÄ±cÄ± ayarlanÄ±rken bir hata oluÅŸtu: ' + data.error);
        }
    });
}

function deleteQuestion(questionId) {
    if (confirm('Bu soruyu silmek istediÄŸinizden emin misiniz?')) {
        fetch(`/delete_question/${questionId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Soru silinirken bir hata oluÅŸtu.');
            }
        });
    }
}

function completeQuestion(questionId) {
    fetch(`/update_repeat_count/${questionId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.is_completed) {
                alert('Tebrikler! Bu soruyu 3 kez tekrar ettiniz ve artÄ±k tamamlandÄ± olarak iÅŸaretlendi.');
            } else {
                alert(`Tekrar sayÄ±sÄ± gÃ¼ncellendi. Sonraki tekrar tarihi: ${data.next_repeat_date}`);
            }
            location.reload();
        } else {
            alert('Soru tamamlanÄ±rken bir hata oluÅŸtu.');
        }
    });
}

function hideQuestion(questionId) {
    if (confirm('Bu soruyu tekrar listelerinde ve ana listede bir daha gÃ¶rmek istemediÄŸinize emin misiniz?')) {
        fetch(`/hide_question/${questionId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Soru gizlenirken bir hata oluÅŸtu.');
            }
        });
    }
}
</script>
{% endblock %} 